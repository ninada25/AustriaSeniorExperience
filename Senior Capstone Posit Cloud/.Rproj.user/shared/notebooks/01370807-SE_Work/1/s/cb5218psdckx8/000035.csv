"0","library(randomForest)"
"0","library(dplyr)  # Make sure you have the dplyr package loaded"
"0",""
"0","# Data investigation and preparation"
"0","str(countries_with_happy) # check types of variables"
"1","'data.frame':	"
"1",""
"1","137"
"1",""
"1"," obs. of  "
"1",""
"1","8"
"1",""
"1"," variable"
"1",""
"1","s"
"1",""
"1",":"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Happiness_score  "
"1",""
"1",":"
"1"," num  "
"1",""
"1","3.63 4.59 5.29 3.79 6.39"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Country_or_region"
"1",""
"1",":"
"1"," Factor w/ 137 levels ""Afghanistan"",..: "
"1",""
"1","1 2 3 4 5 6 7 8 9 10"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","GDP              "
"1",""
"1",":"
"1"," int  "
"1",""
"1","521 5254 4279 3432 11653 4212 57305 51513 4721 24051"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Military         "
"1",""
"1",":"
"1"," num  "
"1",""
"1","3.72 4.08 13.81 9.4 2.05"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Health           "
"1",""
"1",":"
"1"," num  "
"1",""
"1","2.01 9.51 10.73 5.43 13.56"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Internet         "
"1",""
"1",":"
"1"," num  "
"1",""
"1","11.4 71.8 47.7 14.3 75.8 69.7 86.5 87.9 79 95.9"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Unemployment     "
"1",""
"1",":"
"1"," num  "
"1",""
"1","1.5 13.9 12.1 7.3 9.5 17.7 5.4 4.8 5.2 1"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Region           "
"1",""
"1",":"
"1"," Factor w/ 11 levels ""ASIA (EX. NEAR EAST)"",..: "
"1",""
"1","1 4 7 10 5 3 9 11 3 6"
"1",""
"1"," ..."
"1",""
"1","
"
"0","summary(countries_with_happy) # investigate data"
"1",""
"1"," Happiness_score"
"1","   Country_or_region"
"1","      GDP        "
"1","    Military   "
"1","     Health    "
"1","    Internet   "
"1","  Unemployment  "
"1","                  Region  "
"1","
"
"1"," Min.   :2.90   "
"1"," Afghanistan:  1    "
"1"," Min.   :   275  "
"1"," Min.   : 0.0  "
"1"," Min.   : 0.0  "
"1"," Min.   : 2.0  "
"1"," Min.   : 0.10  "
"1"," SUB-SAHARAN AFRICA  :36  "
"1","
"
"1"," 1st Qu.:4.45   "
"1"," Albania    :  1    "
"1"," 1st Qu.:  1708  "
"1"," 1st Qu.: 3.0  "
"1"," 1st Qu.: 7.0  "
"1"," 1st Qu.:27.6  "
"1"," 1st Qu.: 3.40  "
"1"," WESTERN EUROPE      :22  "
"1","
"
"1"," Median :5.47   "
"1"," Algeria    :  1    "
"1"," Median :  6120  "
"1"," Median : 4.8  "
"1"," Median :10.4  "
"1"," Median :57.6  "
"1"," Median : 5.25  "
"1"," LATIN AMER. & CARIB :20  "
"1","
"
"1"," Mean   :5.42   "
"1"," Angola     :  1    "
"1"," Mean   : 15980  "
"1"," Mean   : 6.2  "
"1"," Mean   :11.3  "
"1"," Mean   :53.8  "
"1"," Mean   : 6.78  "
"1"," ASIA (EX. NEAR EAST):18  "
"1","
"
"1"," 3rd Qu.:6.31   "
"1"," Argentina  :  1    "
"1"," 3rd Qu.: 20975  "
"1"," 3rd Qu.: 8.4  "
"1"," 3rd Qu.:14.5  "
"1"," 3rd Qu.:78.8  "
"1"," 3rd Qu.: 9.03  "
"1"," NEAR EAST           :11  "
"1","
"
"1"," Max.   :7.63   "
"1"," Armenia    :  1    "
"1"," Max.   :114340  "
"1"," Max.   :31.9  "
"1"," Max.   :39.5  "
"1"," Max.   :98.3  "
"1"," Max.   :27.00  "
"1"," C.W. OF IND. STATES :10  "
"1","
"
"1","                "
"1"," (Other)    :131    "
"1"," NA's   :1       "
"1"," NA's   :8     "
"1"," NA's   :3     "
"1"," NA's   :1     "
"1"," NA's   :1      "
"1"," (Other)             :20  "
"1","
"
"0","dim(countries_with_happy) # check number of rows and columns - 137 rows, 9 columns"
"1","[1]"
"1"," 137"
"1","   8"
"1","
"
"0","# Convert nominal categorical predictors from character to factor (Country_or_region, Region)"
"0","countries_with_happy$Country_or_region <- as.factor(countries_with_happy$Country_or_region)"
"0","countries_with_happy$Region <- as.factor(countries_with_happy$Region)"
"0",""
"0","# Eliminate 'Country_or_region' variable (factor with 137 levels) - I previously got an error: "
"0","countries_with_happy <- dplyr::select(countries_with_happy, -Country_or_region)"
"0",""
"0","# Impute missing values using rfImpute"
"0","countries_with_happy_imputed <- rfImpute(Happiness_score ~., countries_with_happy, ntree = 500) # not letting me; I have two many factor levels in countries"
"1","     |      Out-of-bag   "
"1","|
"
"1","Tree |      MSE  %Var(y) "
"1","|
"
"1"," 500 |"
"1","   0.2747    21.15 "
"1","|
"
"1","     |      Out-of-bag   "
"1","|
"
"1","Tree |      MSE  %Var(y) "
"1","|
"
"1"," 500 |"
"1","   0.2798    21.55 "
"1","|
"
"1","     |      Out-of-bag   "
"1","|
"
"1","Tree |      MSE  %Var(y) "
"1","|
"
"1"," 500 |"
"1","   0.2816    21.69 "
"1","|
"
"1","     |      Out-of-bag   "
"1","|
"
"1","Tree |      MSE  %Var(y) "
"1","|
"
"1"," 500 |"
"1","   0.2879    22.17 "
"1","|
"
"1","     |      Out-of-bag   "
"1","|
"
"1","Tree |      MSE  %Var(y) "
"1","|
"
"1"," 500 |"
"1","   0.2907    22.38 "
"1","|
"
"0","# Run the random forest model"
"0","set.seed(01242024)"
"0","rf <- randomForest(Happiness_score ~., data = countries_with_happy_imputed, ntree = 500)"
"0","print(rf)"
"1","
Call:
"
"1"," "
"1","randomForest(formula = Happiness_score ~ ., data = countries_with_happy_imputed, "
"1"," "
"1","    ntree = 500)"
"1"," "
"1","
"
"1","               Type of random forest: "
"1",""
"1","regression"
"1",""
"1","
"
"1","                     Number of trees: "
"1",""
"1","500"
"1",""
"1","
"
"1","No. of variables tried at each split: "
"1",""
"1","2"
"1",""
"1","

"
"1","          Mean of squared residuals: "
"1",""
"1","0.287"
"1",""
"1","
"
"1","                    % Var explained: "
"1",""
"1","77.9"
"1",""
"1","
"
"0","# Find the optimal mtry value"
"0","# want to select the mtry value with the minimum out of bag (OOB) error"
"0",""
"0","mtry <- tuneRF(countries_with_happy_imputed[-1], countries_with_happy_imputed$Happiness_score, ntreeTry = 500,stepFactor=1.5,improve=0.01, trace=TRUE, plot=TRUE)"
"1","mtry ="
"1"," "
"1","2"
"1"," "
"1"," OOB error ="
"1"," "
"1","0.284"
"1"," "
"1","
"
"1","Searching"
"1"," "
"1","left"
"1"," "
"1","...
"
"1","Searching"
"1"," "
"1","right"
"1"," "
"1","...
"
"1","mtry ="
"1"," "
"1","3"
"1"," "
"1","	OOB error ="
"1"," "
"1","0.286"
"1"," "
"1","
"
"1","-0.00919"
"1"," "
"1","0.01"
"1"," "
"1","
"
